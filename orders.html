<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders - Photographer Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="script.js"></script>
    <style>
        /* Orders Page Specific Styles */
        :root {
            --primary-color: #667eea;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #8b5cf6;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --bg-primary: #1e293b;
            --bg-secondary: #334155;
            --border-color: #475569;
        }

        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .orders-header {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header-title h1 {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
            color: var(--text-primary);
        }

        .header-title p {
            color: var(--text-secondary);
            margin: 4px 0 0 0;
            font-size: 14px;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .period-pills {
            display: flex;
            gap: 8px;
        }

        .period-pill {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-secondary);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .period-pill.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--success-color);
            color: white;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .live-badge.paused {
            background: var(--text-secondary);
        }

        .live-indicator {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .live-badge.paused .live-indicator {
            animation: none;
            opacity: 0.5;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Filter Bar */
        .filter-bar {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }

        .filter-row {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
            min-width: 140px;
            max-width: 200px;
        }



        .filter-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            min-width: 120px;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            min-width: 120px;
        }

        .saved-views {
            position: relative;
        }

        .saved-views-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .saved-views-dropdown.show {
            display: block;
        }

        .saved-view-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
        }

        .saved-view-item:hover {
            background: var(--bg-secondary);
        }

        .saved-view-item:last-child {
            border-bottom: none;
        }

        /* Custom Multi-Select Styles */
        .custom-multiselect {
            position: relative;
            min-width: 160px;
        }

        .multiselect-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 36px;
        }

        .multiselect-trigger:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .multiselect-trigger.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .multiselect-placeholder {
            color: var(--text-secondary);
            flex: 1;
        }

        .multiselect-placeholder.has-selection {
            color: var(--text-primary);
            font-weight: 500;
        }

        .multiselect-trigger.has-selection {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            border-color: var(--primary-color);
        }

        .multiselect-arrow {
            width: 16px;
            height: 16px;
            color: var(--text-secondary);
            transition: transform 0.2s ease;
            flex-shrink: 0;
            margin-left: 8px;
        }

        .multiselect-trigger.active .multiselect-arrow {
            transform: rotate(180deg);
        }

        .multiselect-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            margin-top: 4px;
        }

        .multiselect-dropdown.show {
            display: block;
        }

        .multiselect-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid var(--border-color);
        }

        .multiselect-option:hover {
            background: var(--bg-secondary);
        }

        .multiselect-option:last-child {
            border-bottom: none;
        }

        .multiselect-option.selected {
            background: rgba(102, 126, 234, 0.1);
        }

        .multiselect-option.selected .payment-icon {
            animation: pulse 0.6s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        .option-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-color);
            border-radius: 3px;
            margin-right: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .multiselect-option.selected .option-checkbox {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .check-icon {
            width: 12px;
            height: 12px;
            color: white;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .multiselect-option.selected .check-icon {
            opacity: 1;
        }

        .option-label {
            flex: 1;
            font-size: 14px;
            color: var(--text-primary);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
            flex-shrink: 0;
        }

        .status-indicator.completed {
            background: var(--success-color);
        }

        .status-indicator.pending {
            background: var(--warning-color);
        }

        .status-indicator.cancelled {
            background: var(--danger-color);
        }

        .status-indicator.refunded {
            background: var(--info-color);
        }

        .payment-icon {
            margin-left: 8px;
            font-size: 16px;
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            background: var(--bg-secondary);
            transition: all 0.2s ease;
        }

        .payment-icon.stripe {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .payment-icon.lemonway {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .payment-icon.cash {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .payment-icon.paypal {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #003087;
        }

        .payment-icon.bank {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #2c3e50;
        }

        .multiselect-option:hover .payment-icon {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        /* Enhanced payment method filter styling */
        .filter-group:has(.custom-multiselect) {
            position: relative;
        }

        .filter-group:has(.custom-multiselect)::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), #764ba2);
            border-radius: 1px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .filter-group:has(.custom-multiselect:hover)::after,
        .filter-group:has(.multiselect-dropdown.show)::after {
            opacity: 1;
        }

        .multiselect-option {
            position: relative;
            overflow: hidden;
        }

        .multiselect-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .multiselect-option:hover::before {
            left: 100%;
        }

        /* Enhanced tooltips for payment methods */
        .payment-icon[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            z-index: 1001;
            margin-bottom: 5px;
            opacity: 0;
            animation: fadeIn 0.2s ease forwards;
        }

        .payment-icon[title]:hover::before {
            content: '';
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--bg-primary);
            margin-bottom: -5px;
            z-index: 1001;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* Selected items display */
        .selected-items {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 4px;
        }

        .selected-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            background: var(--primary-color);
            color: white;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .selected-item-remove {
            cursor: pointer;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: background-color 0.2s ease;
        }

        .selected-item-remove:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), #764ba2);
        }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .kpi-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kpi-delta {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .kpi-delta.positive {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .kpi-delta.negative {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .kpi-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Analytics Charts */
        .analytics-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .chart-card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Table Styles */
        .table-container {
            background: var(--bg-primary);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .table-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background: var(--bg-secondary);
            border-color: var(--primary-color);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
            border-color: var(--danger-color);
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }

        .orders-table th {
            background: var(--bg-secondary);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .orders-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .orders-table tbody tr:hover {
            background: var(--bg-secondary);
        }

        .orders-table tbody tr:nth-child(even) {
            background: rgba(0, 0, 0, 0.02);
        }

        .status-pill {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .status-cancelled {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .status-refunded {
            background: rgba(139, 92, 246, 0.1);
            color: var(--info-color);
        }

        .row-actions {
            display: flex;
            gap: 4px;
        }

        .action-icon {
            padding: 4px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-icon:hover {
            background: var(--bg-secondary);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }

        .pagination-info {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pagination-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .pagination-btn:hover {
            background: var(--bg-secondary);
        }

        .pagination-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .filter-row {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .filter-group {
                flex: none;
                min-width: 100%;
                max-width: none;
            }

            .header-controls {
                flex-direction: column;
                gap: 12px;
            }

            .table-header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .orders-table {
                font-size: 12px;
            }

            .orders-table th,
            .orders-table td {
                padding: 8px 12px;
            }

            .custom-multiselect {
                min-width: 100%;
            }

            .multiselect-dropdown {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 300px;
                max-height: 60vh;
                z-index: 1001;
            }

            .multiselect-option {
                padding: 12px 16px;
                font-size: 16px;
            }
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Side Navigation -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Dashboard</h2>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Main</div>
                <a href="this-season.html" class="nav-item" data-page="this-season">
                    <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                    </svg>
                    This season
                </a>
                <a href="analytics.html" class="nav-item" data-page="analytics">
                    <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3v18h18"></path>
                        <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"></path>
                    </svg>
                    Analytics
                </a>
                <a href="orders.html" class="nav-item active" data-page="orders">
                    <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <path d="M16 10a4 4 0 0 1-8 0"></path>
                    </svg>
                    Orders
                </a>
                <a href="products.html" class="nav-item" data-page="products">
                    <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                    </svg>
                    Products
                </a>
                <a href="schools.html" class="nav-item" data-page="schools">
                    <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                        <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                    </svg>
                    Schools
                </a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Settings</div>
                <a href="settings.html" class="nav-item" data-page="settings">
                    <svg class="nav-item-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    Settings
                </a>
            </div>
        </nav>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="orders-header">
            <div class="header-top">
                <div class="header-title">
                    <h1>Orders</h1>
                    <p>Manage and track all your orders</p>
                </div>
                <div class="header-controls">
                    <div class="period-pills">
                        <button class="period-pill active" data-period="all">All Time</button>
                        <button class="period-pill" data-period="month">This Month</button>
                        <button class="period-pill" data-period="week">This Week</button>
                    </div>
                    <div class="live-badge" id="liveBadge">
                        <div class="live-indicator"></div>
                        <span>LIVE</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Bar -->
        <div class="filter-bar">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="filter-label">Date Range</label>
                    <select class="filter-select" id="dateRange">
                        <option value="all">All Time</option>
                        <option value="today">Today</option>
                        <option value="7days">Last 7 Days</option>
                        <option value="month">This Month</option>
                        <option value="lastMonth">Last Month</option>
                        <option value="ytd">Year to Date</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Status</label>
                    <div class="custom-multiselect" id="statusFilterContainer">
                        <div class="multiselect-trigger" id="statusFilterTrigger">
                            <span class="multiselect-placeholder">Select Status</span>
                            <svg class="multiselect-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6,9 12,15 18,9"></polyline>
                            </svg>
                        </div>
                        <div class="multiselect-dropdown" id="statusFilterDropdown">
                            <div class="multiselect-option" data-value="COMPLETED">
                                <div class="option-checkbox">
                                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                            </svg>
                    </div>
                                <span class="option-label">Completed</span>
                                <span class="status-indicator completed"></span>
                </div>
                            <div class="multiselect-option" data-value="PENDING">
                                <div class="option-checkbox">
                                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                                    </svg>
            </div>
                                <span class="option-label">Pending</span>
                                <span class="status-indicator pending"></span>
        </div>
                            <div class="multiselect-option" data-value="CANCELLED">
                                <div class="option-checkbox">
                                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                                    </svg>
                </div>
                                <span class="option-label">Cancelled</span>
                                <span class="status-indicator cancelled"></span>
            </div>
                            <div class="multiselect-option" data-value="REFUNDED">
                                <div class="option-checkbox">
                                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                                    </svg>
                </div>
                                <span class="option-label">Refunded</span>
                                <span class="status-indicator refunded"></span>
            </div>
                </div>
            </div>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Payment Method</label>
                    <div class="custom-multiselect" id="paymentFilterContainer">
                        <div class="multiselect-trigger" id="paymentFilterTrigger">
                                                          <span class="multiselect-placeholder">Payment Method</span>
                            <svg class="multiselect-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6,9 12,15 18,9"></polyline>
                            </svg>
                        </div>
                        <div class="multiselect-dropdown" id="paymentFilterDropdown">
                            <div class="multiselect-option" data-value="Stripe">
                                <div class="option-checkbox">
                                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                                    </svg>
                                </div>
                                <span class="option-label">Stripe</span>
                                <span class="payment-icon stripe" title="Credit/Debit Cards">💳</span>
                            </div>
                            <div class="multiselect-option" data-value="Lemonway">
                                <div class="option-checkbox">
                                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                                    </svg>
                                </div>
                                <span class="option-label">Lemonway</span>
                                <span class="payment-icon lemonway" title="European Payment Gateway">🍋</span>
                            </div>
                            <div class="multiselect-option" data-value="PayPal">
                                <div class="option-checkbox">
                                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                                    </svg>
                                </div>
                                <span class="option-label">PayPal</span>
                                <span class="payment-icon paypal" title="Digital Wallet">📱</span>
                            </div>
                            <div class="multiselect-option" data-value="Cash">
                                <div class="option-checkbox">
                                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                                    </svg>
                                </div>
                                <span class="option-label">Cash</span>
                                <span class="payment-icon cash" title="Physical Cash Payment">💵</span>
                            </div>
                            <div class="multiselect-option" data-value="Bank Transfer">
                                <div class="option-checkbox">
                                    <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20,6 9,17 4,12"></polyline>
                                    </svg>
                                </div>
                                <span class="option-label">Bank Transfer</span>
                                <span class="payment-icon bank" title="Direct Bank Transfer">🏦</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Search</label>
                    <input type="text" class="filter-input" id="searchInput" placeholder="ID, customer, email, phone...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Saved Views</label>
                    <select class="filter-select" id="savedViews">
                        <option value="">Select View</option>
                        <option value="all">All Orders</option>
                        <option value="completed">Completed Only</option>
                        <option value="stripe-month">Stripe - This Month</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="kpi-grid" id="kpiGrid">
            <!-- KPI cards will be populated by JavaScript -->
            </div>

        <!-- Analytics Charts -->
        <div class="analytics-grid">
            <div class="chart-card">
                <h3 class="chart-title">Revenue by Day</h3>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">Orders by Status</h3>
                <div class="chart-container">
                    <canvas id="statusChart"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">Top Products</h3>
                <div class="chart-container">
                    <canvas id="productsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Orders Table -->
            <div class="table-container">
            <div class="table-header">
                <h3 class="table-title">Orders</h3>
                <div class="table-controls">
                    <div class="table-actions">
                        <button class="btn" id="exportCsv">Export CSV</button>
                        <button class="btn" id="exportExcel">Export Excel</button>
                        <button class="btn" id="exportPdf">Export PDF</button>
                        <button class="btn btn-primary" id="bulkActions">Bulk Actions</button>
                    </div>
                </div>
            </div>
            <div class="table-wrapper">
                <table class="orders-table" id="ordersTable">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll"></th>
                            <th>Order ID</th>
                            <th>Date</th>
                            <th>Customer</th>
                            <th>Products</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Payment</th>
                            <th>Event/School</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <!-- Table rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            <div class="pagination" id="pagination">
                <div class="pagination-info" id="paginationInfo">
                    Showing 1-10 of 60 orders
                </div>
                <div class="pagination-controls" id="paginationControls">
                    <button class="pagination-btn" id="prevPage">Previous</button>
                    <button class="pagination-btn active">1</button>
                    <button class="pagination-btn">2</button>
                    <button class="pagination-btn">3</button>
                    <button class="pagination-btn">4</button>
                    <button class="pagination-btn">5</button>
                    <button class="pagination-btn">6</button>
                    <button class="pagination-btn" id="nextPage">Next</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick View Modal -->
    <div class="modal" id="quickViewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Order Details</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div id="modalContent">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // ============================================================================
        // ORDERS PAGE - COMPREHENSIVE FRONTEND IMPLEMENTATION
        // ============================================================================

        // Global State Management
        const OrdersApp = {
            // State
            orders: [],
            filteredOrders: [],
            currentPage: 1,
            pageSize: 10,
            selectedRows: new Set(),
            filters: {
                dateRange: 'all',
                status: [],
                paymentMethod: [],
                search: '',
                savedView: ''
            },
            sort: {
                field: 'date',
                direction: 'desc'
            },
            isLive: true,
            charts: {},

            // Initialize the application
            init() {
                console.log('OrdersApp.init() started');
                this.generateMockData();
                console.log('Mock data generated, orders count:', this.orders.length);
                this.setupEventListeners();
                this.loadUserPreferences();
                this.applyFilters(); // Apply initial filters to populate filteredOrders
                console.log('Filters applied, filteredOrders count:', this.filteredOrders.length);
                this.render();
                console.log('Render completed');
                this.startRealtimeUpdates();
                console.log('OrdersApp.init() completed');
            },

            // Generate comprehensive mock data
            generateMockData() {
                const products = [
                    'Pack S', 'Pack M', 'Pack L', 'Pack XL', 'Pack XXL',
                    'Individual Photo', 'Group Photo', 'Family Photo',
                    'Digital Download', 'Print Package', 'Canvas Print',
                    'Photo Book', 'Calendar', 'Mug', 'T-Shirt'
                ];

                const customers = [
                    { name: 'John Doe', email: 'john.doe@email.com', phone: '+33 1 23 45 67 89' },
                    { name: 'Jane Smith', email: 'jane.smith@email.com', phone: '+33 1 98 76 54 32' },
                    { name: 'Mike Johnson', email: 'mike.j@email.com', phone: '+33 1 11 22 33 44' },
                    { name: 'Sarah Wilson', email: 'sarah.w@email.com', phone: '+33 1 55 66 77 88' },
                    { name: 'David Brown', email: 'david.b@email.com', phone: '+33 1 99 88 77 66' },
                    { name: 'Emma Davis', email: 'emma.d@email.com', phone: '+33 1 12 34 56 78' },
                    { name: 'Alex Thompson', email: 'alex.t@email.com', phone: '+33 1 87 65 43 21' },
                    { name: 'Lisa Anderson', email: 'lisa.a@email.com', phone: '+33 1 45 67 89 01' }
                ];

                const schools = [
                    { name: 'École Saint-Joseph', id: 'SCH001' },
                    { name: 'Lycée Victor Hugo', id: 'SCH002' },
                    { name: 'Collège Marie Curie', id: 'SCH003' },
                    { name: 'École Maternelle Les Petits', id: 'SCH004' },
                    { name: 'Lycée International', id: 'SCH005' }
                ];

                const statuses = ['COMPLETED', 'PENDING', 'CANCELLED', 'REFUNDED'];
                const paymentMethods = ['Stripe', 'Lemonway', 'Cash'];

                this.orders = [];

                for (let i = 1; i <= 60; i++) {
                    const customer = customers[Math.floor(Math.random() * customers.length)];
                    const school = schools[Math.floor(Math.random() * schools.length)];
                    const status = statuses[Math.floor(Math.random() * statuses.length)];
                    const paymentMethod = paymentMethods[Math.floor(Math.random() * paymentMethods.length)];
                    
                    // Generate random date within last 6 months
                    const date = new Date();
                    date.setDate(date.getDate() - Math.floor(Math.random() * 180));
                    
                    // Generate random products (1-4 products per order)
                    const numProducts = Math.floor(Math.random() * 4) + 1;
                    const orderProducts = [];
                    for (let j = 0; j < numProducts; j++) {
                        orderProducts.push(products[Math.floor(Math.random() * products.length)]);
                    }
                    
                    // Generate amount based on products
                    const baseAmount = orderProducts.length * 25 + Math.floor(Math.random() * 100);
                    
                    this.orders.push({
                        id: `ORD${String(i).padStart(3, '0')}`,
                        date: date.toISOString(),
                        customer: customer.name,
                        email: customer.email,
                        phone: customer.phone,
                        products: orderProducts,
                        amount: baseAmount,
                        currency: 'EUR',
                        status: status,
                        payment_method: paymentMethod,
                        event: {
                            name: `${school.name} Photo Day`,
                            school_id: school.id
                        },
                        address: `${Math.floor(Math.random() * 100) + 1} Rue de la ${['Paix', 'Liberté', 'République', 'Victoire'][Math.floor(Math.random() * 4)]}, ${75000 + Math.floor(Math.random() * 20)} Paris`,
                        notes: Math.random() > 0.7 ? 'Special instructions: Please deliver to reception' : '',
                        is_repeat_customer: Math.random() > 0.6
                    });
                }

                // Sort by date (newest first)
                this.orders.sort((a, b) => new Date(b.date) - new Date(a.date));
            },

            // Setup all event listeners
            setupEventListeners() {
                // Period pills
                document.querySelectorAll('.period-pill').forEach(pill => {
                    pill.addEventListener('click', (e) => {
                        document.querySelectorAll('.period-pill').forEach(p => p.classList.remove('active'));
                        e.target.classList.add('active');
                        this.filters.dateRange = e.target.dataset.period;
                        this.applyFilters();
                    });
                });

                // Live badge toggle
                document.getElementById('liveBadge').addEventListener('click', () => {
                    this.isLive = !this.isLive;
                    this.updateLiveBadge();
                });

                // Filter inputs
                document.getElementById('dateRange').addEventListener('change', (e) => {
                    this.filters.dateRange = e.target.value;
                    this.applyFilters();
                });

                // Custom multi-select for status filter
                this.setupCustomMultiselect('statusFilterContainer', 'statusFilterDropdown', 'statusFilterTrigger', 'status');

                // Custom multi-select for payment method filter
                this.setupCustomMultiselect('paymentFilterContainer', 'paymentFilterDropdown', 'paymentFilterTrigger', 'paymentMethod');

                document.getElementById('searchInput').addEventListener('input', this.debounce((e) => {
                    this.filters.search = e.target.value;
                    this.applyFilters();
                }, 300));

                document.getElementById('savedViews').addEventListener('change', (e) => {
                    this.filters.savedView = e.target.value;
                    this.applySavedView();
                });

                // Export buttons
                document.getElementById('exportCsv').addEventListener('click', () => this.exportData('csv'));
                document.getElementById('exportExcel').addEventListener('click', () => this.exportData('excel'));
                document.getElementById('exportPdf').addEventListener('click', () => this.exportData('pdf'));

                // Table controls
                document.getElementById('selectAll').addEventListener('change', (e) => {
                    this.toggleSelectAll(e.target.checked);
                });

                // Pagination
                document.getElementById('prevPage').addEventListener('click', () => this.changePage(-1));
                document.getElementById('nextPage').addEventListener('click', () => this.changePage(1));

                // Modal
                document.getElementById('closeModal').addEventListener('click', () => this.closeModal());
                document.getElementById('quickViewModal').addEventListener('click', (e) => {
                    if (e.target.id === 'quickViewModal') this.closeModal();
                });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') this.closeModal();
                });
            },

            // Setup custom multi-select components
            setupCustomMultiselect(containerId, dropdownId, triggerId, filterType) {
                const container = document.getElementById(containerId);
                const dropdown = document.getElementById(dropdownId);
                const trigger = document.getElementById(triggerId);
                const options = dropdown.querySelectorAll('.multiselect-option');

                // Toggle dropdown
                trigger.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const isOpen = dropdown.classList.contains('show');
                    
                    // Close all other dropdowns
                    document.querySelectorAll('.multiselect-dropdown').forEach(d => d.classList.remove('show'));
                    document.querySelectorAll('.multiselect-trigger').forEach(t => t.classList.remove('active'));
                    
                    if (!isOpen) {
                        dropdown.classList.add('show');
                        trigger.classList.add('active');
                    }
                });

                // Handle option selection
                options.forEach(option => {
                    option.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const value = option.dataset.value;
                        const isSelected = option.classList.contains('selected');
                        
                        if (isSelected) {
                            option.classList.remove('selected');
                            this.removeFilterValue(filterType, value);
                        } else {
                            option.classList.add('selected');
                            this.addFilterValue(filterType, value);
                        }
                        
                        this.updateFilterDisplay(triggerId, filterType);
                        this.applyFilters();
                });
            });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!container.contains(e.target)) {
                        dropdown.classList.remove('show');
                        trigger.classList.remove('active');
                    }
                });
            },

            // Add filter value
            addFilterValue(filterType, value) {
                if (filterType === 'status') {
                    if (!this.filters.status.includes(value)) {
                        this.filters.status.push(value);
                    }
                } else if (filterType === 'paymentMethod') {
                    if (!this.filters.paymentMethod.includes(value)) {
                        this.filters.paymentMethod.push(value);
                    }
                }
            },

            // Remove filter value
            removeFilterValue(filterType, value) {
                if (filterType === 'status') {
                    this.filters.status = this.filters.status.filter(v => v !== value);
                } else if (filterType === 'paymentMethod') {
                    this.filters.paymentMethod = this.filters.paymentMethod.filter(v => v !== value);
                }
            },

                            // Update filter display
                updateFilterDisplay(triggerId, filterType) {
                    const trigger = document.getElementById(triggerId);
                    const placeholder = trigger.querySelector('.multiselect-placeholder');
                    let selectedValues = [];
                    
                    if (filterType === 'status') {
                        selectedValues = this.filters.status;
                    } else if (filterType === 'paymentMethod') {
                        selectedValues = this.filters.paymentMethod;
                    }

                    if (selectedValues.length === 0) {
                        placeholder.textContent = filterType === 'status' ? 'Select Status' : 'Payment Method';
                        placeholder.classList.remove('has-selection');
                        trigger.classList.remove('has-selection');
                    } else if (selectedValues.length === 1) {
                        placeholder.textContent = selectedValues[0];
                        placeholder.classList.add('has-selection');
                        trigger.classList.add('has-selection');
                    } else {
                        // Show first method + count for payment methods
                        if (filterType === 'paymentMethod' && selectedValues.length > 1) {
                            placeholder.textContent = `${selectedValues[0]} +${selectedValues.length - 1} more`;
                        } else {
                            placeholder.textContent = `${selectedValues.length} selected`;
                        }
                        placeholder.classList.add('has-selection');
                        trigger.classList.add('has-selection');
                    }
                },

            // Apply filters and update view
            applyFilters() {
                this.filteredOrders = this.orders.filter(order => {
                    // Date range filter
                    if (this.filters.dateRange !== 'all') {
                        const orderDate = new Date(order.date);
                        const now = new Date();
                        const startDate = new Date();

                        switch (this.filters.dateRange) {
                            case 'today':
                                startDate.setHours(0, 0, 0, 0);
                                if (orderDate < startDate) return false;
                                break;
                            case '7days':
                                startDate.setDate(now.getDate() - 7);
                                if (orderDate < startDate) return false;
                                break;
                            case 'month':
                                startDate.setDate(1);
                                startDate.setHours(0, 0, 0, 0);
                                if (orderDate < startDate) return false;
                                break;
                            case 'lastMonth':
                                startDate.setMonth(now.getMonth() - 1);
                                startDate.setDate(1);
                                startDate.setHours(0, 0, 0, 0);
                                const endDate = new Date(startDate);
                                endDate.setMonth(endDate.getMonth() + 1);
                                if (orderDate < startDate || orderDate >= endDate) return false;
                                break;
                            case 'ytd':
                                startDate.setMonth(0, 1);
                                startDate.setHours(0, 0, 0, 0);
                                if (orderDate < startDate) return false;
                                break;
                        }
                    }

                    // Status filter
                    if (this.filters.status.length > 0 && !this.filters.status.includes(order.status)) {
                        return false;
                    }

                    // Payment method filter
                    if (this.filters.paymentMethod.length > 0 && !this.filters.paymentMethod.includes(order.payment_method)) {
                        return false;
                    }

                    // Search filter
                    if (this.filters.search) {
                        const searchTerm = this.filters.search.toLowerCase();
                        const searchableText = [
                            order.id,
                            order.customer,
                            order.email,
                            order.phone,
                            order.event.school_id,
                            order.products.join(' ')
                        ].join(' ').toLowerCase();
                        
                        if (!searchableText.includes(searchTerm)) return false;
                    }

                    return true;
                });

                // Apply sorting
                this.applySorting();
                
                // Reset to first page
                this.currentPage = 1;
                
                // Update view
                this.render();
            },

            // Apply sorting
            applySorting() {
                this.filteredOrders.sort((a, b) => {
                    let aVal, bVal;

                    switch (this.sort.field) {
                        case 'date':
                            aVal = new Date(a.date);
                            bVal = new Date(b.date);
                            break;
                        case 'amount':
                            aVal = a.amount;
                            bVal = b.amount;
                            break;
                        case 'customer':
                            aVal = a.customer.toLowerCase();
                            bVal = b.customer.toLowerCase();
                            break;
                        case 'status':
                            aVal = a.status;
                            bVal = b.status;
                            break;
                        default:
                            aVal = a[this.sort.field];
                            bVal = b[this.sort.field];
                    }

                    if (aVal < bVal) return this.sort.direction === 'asc' ? -1 : 1;
                    if (aVal > bVal) return this.sort.direction === 'asc' ? 1 : -1;
                    return 0;
                });
            },

            // Apply saved view
            applySavedView() {
                switch (this.filters.savedView) {
                    case 'all':
                        this.filters.status = [];
                        this.filters.paymentMethod = [];
                        this.filters.dateRange = 'all';
                        break;
                    case 'completed':
                        this.filters.status = ['COMPLETED'];
                        this.filters.paymentMethod = [];
                        this.filters.dateRange = 'all';
                        break;
                    case 'stripe-month':
                        this.filters.status = [];
                        this.filters.paymentMethod = ['Stripe'];
                        this.filters.dateRange = 'month';
                        break;
                }
                
                // Update UI to reflect saved view
                this.updateFilterUI();
                this.applyFilters();
            },

            // Update filter UI to reflect current state
            updateFilterUI() {
                // Update date range
                document.getElementById('dateRange').value = this.filters.dateRange;
                
                // Update status filter
                const statusSelect = document.getElementById('statusFilter');
                Array.from(statusSelect.options).forEach(option => {
                    option.selected = this.filters.status.includes(option.value);
                });
                
                // Update payment filter
                const paymentSelect = document.getElementById('paymentFilter');
                Array.from(paymentSelect.options).forEach(option => {
                    option.selected = this.filters.paymentMethod.includes(option.value);
                });
                
                // Update search
                document.getElementById('searchInput').value = this.filters.search;
            },

            // Render the entire application
            render() {
                console.log('OrdersApp.render() started');
                this.renderKPIs();
                console.log('KPIs rendered');
                this.renderTable();
                console.log('Table rendered');
                this.renderPagination();
                console.log('Pagination rendered');
                this.renderCharts();
                console.log('Charts rendered');
                this.saveUserPreferences();
                console.log('OrdersApp.render() completed');
            },

            // Render KPI cards
            renderKPIs() {
                const kpiGrid = document.getElementById('kpiGrid');
                
                // Calculate KPIs from filtered data
                const totalOrders = this.filteredOrders.length;
                const totalRevenue = this.filteredOrders.reduce((sum, order) => sum + order.amount, 0);
                const avgOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;
                const completedOrders = this.filteredOrders.filter(order => order.status === 'COMPLETED').length;
                const completionRate = totalOrders > 0 ? (completedOrders / totalOrders) * 100 : 0;

                // Calculate deltas (simplified - compare with previous period)
                const previousPeriodOrders = this.orders.length - totalOrders;
                const previousPeriodRevenue = this.orders.reduce((sum, order) => sum + order.amount, 0) - totalRevenue;
                
                const orderDelta = previousPeriodOrders > 0 ? ((totalOrders - previousPeriodOrders) / previousPeriodOrders) * 100 : 0;
                const revenueDelta = previousPeriodRevenue > 0 ? ((totalRevenue - previousPeriodRevenue) / previousPeriodRevenue) * 100 : 0;
                const avgDelta = orderDelta; // Simplified
                const completionDelta = 2.5; // Mock delta

                kpiGrid.innerHTML = `
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-title">Total Orders</div>
                            <div class="kpi-delta ${orderDelta >= 0 ? 'positive' : 'negative'}">
                                ${orderDelta >= 0 ? '↑' : '↓'} ${Math.abs(orderDelta).toFixed(1)}%
                            </div>
                        </div>
                        <div class="kpi-value">${totalOrders.toLocaleString()}</div>
                        <div class="kpi-subtitle">From filtered results</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-title">Total Revenue</div>
                            <div class="kpi-delta ${revenueDelta >= 0 ? 'positive' : 'negative'}">
                                ${revenueDelta >= 0 ? '↑' : '↓'} ${Math.abs(revenueDelta).toFixed(1)}%
                            </div>
                        </div>
                        <div class="kpi-value">€${totalRevenue.toLocaleString()}</div>
                        <div class="kpi-subtitle">From filtered results</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-title">Average Order Value</div>
                            <div class="kpi-delta ${avgDelta >= 0 ? 'positive' : 'negative'}">
                                ${avgDelta >= 0 ? '↑' : '↓'} ${Math.abs(avgDelta).toFixed(1)}%
                            </div>
                        </div>
                        <div class="kpi-value">€${avgOrderValue.toFixed(0)}</div>
                        <div class="kpi-subtitle">From filtered results</div>
                    </div>
                    
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-title">Completion Rate</div>
                            <div class="kpi-delta ${completionDelta >= 0 ? 'positive' : 'negative'}">
                                ${completionDelta >= 0 ? '↑' : '↓'} ${Math.abs(completionDelta).toFixed(1)}%
                            </div>
                        </div>
                        <div class="kpi-value">${completionRate.toFixed(1)}%</div>
                        <div class="kpi-subtitle">${completedOrders} of ${totalOrders} orders</div>
                    </div>
                `;
            },

            // Render the orders table
            renderTable() {
                const tbody = document.getElementById('ordersTableBody');
                const startIndex = (this.currentPage - 1) * this.pageSize;
                const endIndex = startIndex + this.pageSize;
                const pageOrders = this.filteredOrders.slice(startIndex, endIndex);

                tbody.innerHTML = pageOrders.map(order => `
                    <tr data-order-id="${order.id}">
                        <td>
                            <input type="checkbox" class="row-checkbox" value="${order.id}" 
                                   ${this.selectedRows.has(order.id) ? 'checked' : ''}>
                        </td>
                        <td>${order.id}</td>
                        <td>${new Date(order.date).toLocaleDateString()}</td>
                        <td>${order.customer}</td>
                        <td title="${order.products.join(', ')}">
                            ${order.products.length > 2 ? 
                                `${order.products[0]}, ${order.products[1]} +${order.products.length - 2} more` : 
                                order.products.join(', ')}
                        </td>
                        <td>€${order.amount.toLocaleString()}</td>
                        <td>
                            <span class="status-pill status-${order.status.toLowerCase()}" 
                                  title="${this.getStatusTooltip(order.status)}">
                                ${order.status}
                            </span>
                        </td>
                        <td>${order.payment_method}</td>
                        <td>${order.event.name}</td>
                        <td>
                            <div class="row-actions">
                                <div class="action-icon" onclick="OrdersApp.quickView('${order.id}')" title="View Details">
                                    👁️
                                </div>
                                <div class="action-icon" onclick="OrdersApp.editOrder('${order.id}')" title="Edit">
                                    ✏️
                                </div>
                                <div class="action-icon" onclick="OrdersApp.downloadInvoice('${order.id}')" title="Download Invoice">
                                    📄
                                </div>
                                <div class="action-icon" onclick="OrdersApp.sendEmail('${order.id}')" title="Send Email">
                                    📧
                                </div>
                            </div>
                        </td>
                    </tr>
                `).join('');

                // Add event listeners to checkboxes
                tbody.querySelectorAll('.row-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            this.selectedRows.add(e.target.value);
                        } else {
                            this.selectedRows.delete(e.target.value);
                        }
                        this.updateSelectAllState();
                    });
                });
            },

            // Render pagination
            renderPagination() {
                const totalPages = Math.ceil(this.filteredOrders.length / this.pageSize);
                const paginationInfo = document.getElementById('paginationInfo');
                const paginationControls = document.getElementById('paginationControls');
                
                const startItem = (this.currentPage - 1) * this.pageSize + 1;
                const endItem = Math.min(this.currentPage * this.pageSize, this.filteredOrders.length);
                
                paginationInfo.textContent = `Showing ${startItem}-${endItem} of ${this.filteredOrders.length} orders`;

                // Generate pagination buttons
                let paginationHTML = `
                    <button class="pagination-btn" id="prevPage" ${this.currentPage === 1 ? 'disabled' : ''}>
                        Previous
                    </button>
                `;

                const maxVisiblePages = 5;
                let startPage = Math.max(1, this.currentPage - Math.floor(maxVisiblePages / 2));
                let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

                if (endPage - startPage + 1 < maxVisiblePages) {
                    startPage = Math.max(1, endPage - maxVisiblePages + 1);
                }

                for (let i = startPage; i <= endPage; i++) {
                    paginationHTML += `
                        <button class="pagination-btn ${i === this.currentPage ? 'active' : ''}" 
                                onclick="OrdersApp.goToPage(${i})">
                            ${i}
                        </button>
                    `;
                }

                paginationHTML += `
                    <button class="pagination-btn" id="nextPage" ${this.currentPage === totalPages ? 'disabled' : ''}>
                        Next
                    </button>
                `;

                paginationControls.innerHTML = paginationHTML;

                // Re-add event listeners
                document.getElementById('prevPage').addEventListener('click', () => this.changePage(-1));
                document.getElementById('nextPage').addEventListener('click', () => this.changePage(1));
            },

            // Render charts
            renderCharts() {
                console.log('renderCharts() started');
                this.renderRevenueChart();
                console.log('Revenue chart rendered');
                this.renderStatusChart();
                console.log('Status chart rendered');
                this.renderProductsChart();
                console.log('Products chart rendered');
                console.log('renderCharts() completed');
            },

            // Render revenue chart
            renderRevenueChart() {
                console.log('renderRevenueChart() started');
                const ctx = document.getElementById('revenueChart');
                console.log('Canvas element found:', ctx);
                
                // Group orders by date and calculate daily revenue
                const dailyRevenue = {};
                this.filteredOrders.forEach(order => {
                    const date = new Date(order.date).toLocaleDateString();
                    dailyRevenue[date] = (dailyRevenue[date] || 0) + order.amount;
                });

                const labels = Object.keys(dailyRevenue).slice(-14); // Last 14 days
                const data = labels.map(date => dailyRevenue[date] || 0);
                console.log('Chart data prepared:', { labels, data });

                if (this.charts.revenue) {
                    this.charts.revenue.destroy();
                }

                this.charts.revenue = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Daily Revenue (€)',
                            data: data,
                            backgroundColor: 'rgba(102, 126, 234, 0.8)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '€' + value.toLocaleString();
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            },

            // Render status chart
            renderStatusChart() {
                const ctx = document.getElementById('statusChart');
                
                // Count orders by status
                const statusCounts = {};
                this.filteredOrders.forEach(order => {
                    statusCounts[order.status] = (statusCounts[order.status] || 0) + 1;
                });

                const labels = Object.keys(statusCounts);
                const data = Object.values(statusCounts);
                const colors = {
                    'COMPLETED': '#10b981',
                    'PENDING': '#f59e0b',
                    'CANCELLED': '#ef4444',
                    'REFUNDED': '#8b5cf6'
                };

                if (this.charts.status) {
                    this.charts.status.destroy();
                }

                this.charts.status = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: labels.map(status => colors[status]),
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            },

            // Render products chart
            renderProductsChart() {
                const ctx = document.getElementById('productsChart');
                
                // Calculate revenue by product
                const productRevenue = {};
                this.filteredOrders.forEach(order => {
                    order.products.forEach(product => {
                        productRevenue[product] = (productRevenue[product] || 0) + (order.amount / order.products.length);
                    });
                });

                // Get top 5 products
                const sortedProducts = Object.entries(productRevenue)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);

                const labels = sortedProducts.map(([product]) => product);
                const data = sortedProducts.map(([, revenue]) => revenue);

                if (this.charts.products) {
                    this.charts.products.destroy();
                }

                this.charts.products = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Revenue (€)',
                            data: data,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '€' + value.toLocaleString();
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            },

            // Utility functions
            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            getStatusTooltip(status) {
                const tooltips = {
                    'COMPLETED': 'Order has been fulfilled and delivered',
                    'PENDING': 'Awaiting payment confirmation',
                    'CANCELLED': 'Order was cancelled by customer or system',
                    'REFUNDED': 'Payment was refunded to customer'
                };
                return tooltips[status] || status;
            },

            // Table actions
            toggleSelectAll(checked) {
                const checkboxes = document.querySelectorAll('.row-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = checked;
                    if (checked) {
                        this.selectedRows.add(checkbox.value);
                    } else {
                        this.selectedRows.delete(checkbox.value);
                    }
                });
            },

            updateSelectAllState() {
                const checkboxes = document.querySelectorAll('.row-checkbox');
                const selectAllCheckbox = document.getElementById('selectAll');
                const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
                
                selectAllCheckbox.checked = checkedCount === checkboxes.length;
                selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
            },

            changePage(delta) {
                const newPage = this.currentPage + delta;
                const totalPages = Math.ceil(this.filteredOrders.length / this.pageSize);
                
                if (newPage >= 1 && newPage <= totalPages) {
                    this.currentPage = newPage;
                    this.renderTable();
                    this.renderPagination();
                }
            },

            goToPage(page) {
                this.currentPage = page;
                this.renderTable();
                this.renderPagination();
            },

            // Modal functions
            quickView(orderId) {
                const order = this.orders.find(o => o.id === orderId);
                if (!order) return;

                const modal = document.getElementById('quickViewModal');
                const modalContent = document.getElementById('modalContent');

                modalContent.innerHTML = `
                    <div style="display: grid; gap: 16px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div>
                                <strong>Order ID:</strong> ${order.id}
                            </div>
                            <div>
                                <strong>Date:</strong> ${new Date(order.date).toLocaleDateString()}
                            </div>
                            <div>
                                <strong>Customer:</strong> ${order.customer}
                            </div>
                            <div>
                                <strong>Email:</strong> ${order.email}
                            </div>
                            <div>
                                <strong>Phone:</strong> ${order.phone}
                            </div>
                            <div>
                                <strong>Status:</strong> 
                                <span class="status-pill status-${order.status.toLowerCase()}">${order.status}</span>
                            </div>
                            <div>
                                <strong>Payment Method:</strong> ${order.payment_method}
                            </div>
                            <div>
                                <strong>Amount:</strong> €${order.amount.toLocaleString()}
                            </div>
                        </div>
                        
                        <div>
                            <strong>Products:</strong>
                            <ul style="margin: 8px 0; padding-left: 20px;">
                                ${order.products.map(product => `<li>${product}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div>
                            <strong>Event:</strong> ${order.event.name} (${order.event.school_id})
                        </div>
                        
                        <div>
                            <strong>Address:</strong> ${order.address}
                        </div>
                        
                        ${order.notes ? `<div><strong>Notes:</strong> ${order.notes}</div>` : ''}
                        
                        <div style="display: flex; gap: 8px; margin-top: 16px;">
                            <button class="btn btn-primary" onclick="OrdersApp.downloadInvoice('${order.id}')">
                                Download Invoice
                            </button>
                            <button class="btn" onclick="OrdersApp.sendEmail('${order.id}')">
                                Send Email
                            </button>
                        </div>
                    </div>
                `;

                modal.classList.add('show');
            },

            closeModal() {
                document.getElementById('quickViewModal').classList.remove('show');
            },

            // Action functions
            editOrder(orderId) {
                this.showToast(`Edit order ${orderId} - Feature coming soon!`, 'info');
            },

            downloadInvoice(orderId) {
                this.showToast(`Downloading invoice for ${orderId}...`, 'success');
                // Mock download - in real app, this would generate and download a PDF
            },

            sendEmail(orderId) {
                this.showToast(`Sending email for ${orderId}...`, 'success');
                // Mock email - in real app, this would open email composer
            },

            // Export functions
            exportData(format) {
                const data = this.filteredOrders.map(order => ({
                    'Order ID': order.id,
                    'Date': new Date(order.date).toLocaleDateString(),
                    'Customer': order.customer,
                    'Email': order.email,
                    'Phone': order.phone,
                    'Products': order.products.join(', '),
                    'Amount': order.amount,
                    'Currency': order.currency,
                    'Status': order.status,
                    'Payment Method': order.payment_method,
                    'Event': order.event.name,
                    'School ID': order.event.school_id,
                    'Address': order.address,
                    'Notes': order.notes,
                    'Repeat Customer': order.is_repeat_customer ? 'Yes' : 'No'
                }));

                switch (format) {
                    case 'csv':
                        this.exportCSV(data);
                        break;
                    case 'excel':
                        this.exportExcel(data);
                        break;
                    case 'pdf':
                        this.exportPDF(data);
                        break;
                }
            },

            exportCSV(data) {
                const headers = Object.keys(data[0]);
                const csvContent = [
                    headers.join(','),
                    ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
                ].join('\n');

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `orders_export_${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                this.showToast('CSV export completed!', 'success');
            },

            exportExcel(data) {
                const worksheet = XLSX.utils.json_to_sheet(data);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Orders');
                
                XLSX.writeFile(workbook, `orders_export_${new Date().toISOString().split('T')[0]}.xlsx`);
                this.showToast('Excel export completed!', 'success');
            },

            exportPDF(data) {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const headers = Object.keys(data[0]);
                const rows = data.map(row => Object.values(row));
                
                doc.autoTable({
                    head: [headers],
                    body: rows,
                    startY: 20,
                    styles: {
                        fontSize: 8,
                        cellPadding: 2
                    }
                });
                
                doc.save(`orders_export_${new Date().toISOString().split('T')[0]}.pdf`);
                this.showToast('PDF export completed!', 'success');
            },

            // Realtime updates
            startRealtimeUpdates() {
                if (!this.isLive) return;
                
                setInterval(() => {
                    if (!this.isLive) return;
                    
                    // Generate a new random order
                    this.addRandomOrder();
                }, Math.random() * 20000 + 25000); // 25-45 seconds
            },

            addRandomOrder() {
                const newOrder = this.generateRandomOrder();
                this.orders.unshift(newOrder);
                this.applyFilters();
                
                // Pulse the live badge
                const liveBadge = document.getElementById('liveBadge');
                liveBadge.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    liveBadge.style.transform = 'scale(1)';
                }, 200);
                
                // Show toast notification
                this.showToast(`New order ${newOrder.id} • €${newOrder.amount}`, 'success');
            },

            generateRandomOrder() {
                const customers = [
                    { name: 'New Customer', email: 'new@email.com', phone: '+33 1 00 00 00 00' }
                ];
                const products = ['Pack S', 'Pack M', 'Pack L'];
                const statuses = ['PENDING', 'COMPLETED'];
                const paymentMethods = ['Stripe', 'Lemonway'];
                
                const customer = customers[0];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                const paymentMethod = paymentMethods[Math.floor(Math.random() * paymentMethods.length)];
                const productsList = [products[Math.floor(Math.random() * products.length)]];
                const amount = Math.floor(Math.random() * 200) + 50;
                
                return {
                    id: `ORD${String(this.orders.length + 1).padStart(3, '0')}`,
                    date: new Date().toISOString(),
                    customer: customer.name,
                    email: customer.email,
                    phone: customer.phone,
                    products: productsList,
                    amount: amount,
                    currency: 'EUR',
                    status: status,
                    payment_method: paymentMethod,
                    event: {
                        name: 'New Event',
                        school_id: 'SCH999'
                    },
                    address: '123 New Street, Paris',
                    notes: '',
                    is_repeat_customer: false
                };
            },

            updateLiveBadge() {
                const liveBadge = document.getElementById('liveBadge');
                if (this.isLive) {
                    liveBadge.classList.remove('paused');
                } else {
                    liveBadge.classList.add('paused');
                }
            },

            // Toast notifications
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                
                const container = document.getElementById('toastContainer');
                container.appendChild(toast);
                
                // Trigger animation
                setTimeout(() => toast.classList.add('show'), 100);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (container.contains(toast)) {
                            container.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            },

            // User preferences
            saveUserPreferences() {
                const preferences = {
                    filters: this.filters,
                    sort: this.sort,
                    pageSize: this.pageSize,
                    isLive: this.isLive
                };
                localStorage.setItem('ordersPreferences', JSON.stringify(preferences));
            },

            loadUserPreferences() {
                const saved = localStorage.getItem('ordersPreferences');
                if (saved) {
                    const preferences = JSON.parse(saved);
                    this.filters = { ...this.filters, ...preferences.filters };
                    this.sort = preferences.sort || this.sort;
                    this.pageSize = preferences.pageSize || this.pageSize;
                    this.isLive = preferences.isLive !== undefined ? preferences.isLive : true;
                    
                    this.updateFilterUI();
                    this.updateLiveBadge();
                }
            }
        };

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, Chart.js available:', typeof Chart !== 'undefined');
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded!');
                return;
            }
            OrdersApp.init();
        });
    </script>
</body>
</html>
